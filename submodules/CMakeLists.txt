#http://www.cmake.org/cmake/help/v2.8.11/cmake.html#module:ExternalProject
#http://www.kitware.com/media/html/BuildingExternalProjectsWithCMake2.8.html

include(ExternalProject)


# ------------ osgWorks ---------------------------------

ExternalProject_Add(
	osgWorks
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/osgworks/"
	CMAKE_ARGS -DOPENSCENEGRAPH_LIBRARIES:PATH=${OPENSCENEGRAPH_LIBRARIES}
				-DOPENSCENEGRAPH_INCLUDE_DIR:PATH=${OPENSCENEGRAPH_INCLUDE_DIR}
				-DOSG_LIBRARY:PATH=${OSG_LIBRARY}
				-DOSG_INCLUDE_DIR:PATH=${OSG_INCLUDE_DIR}
				-DOPENTHREADS_LIBRARY:PATH=${OPENTHREADS_LIBRARY}
				-DOPENTHREADS_INCLUDE_DIR:PATH=${OPENTHREADS_INCLUDE_DIR}
#				-DCMAKE_PREFIX_PATH:PATH=${OPENSCENEGRAPH_LIBRARIES}
				-DOSGGA_LIBRARY:PATH=${OSGGA_LIBRARY}
				-DOSGGA_INCLUDE_DIR:PATH=${OSGGA_INCLUDE_DIR}
				-DOSGTEXT_LIBRARY:PATH=${OSGTEXT_LIBRARY}
				-DOSGTEXT_INCLUDE_DIR:PATH=${OSGTEXT_INCLUDE_DIR}
				-DOSGVIEWER_LIBRARY:PATH=${OSGVIEWER_LIBRARY}
				-DOSGVIEWER_INCLUDE_DIR:PATH=${OSGVIEWER_INCLUDE_DIR}
				-DOSGSIM_LIBRARY:PATH=${OSGSIM_LIBRARY}
				-DOSGSIM_INCLUDE_DIR:PATH=${OSGSIM_INCLUDE_DIR}
				-DOSGUTIL_LIBRARY:PATH=${OSGUTIL_LIBRARY}
				-DOSGUTIL_INCLUDE_DIR:PATH=${OSGUTIL_INCLUDE_DIR}
				-DOSGDB_LIBRARY:PATH=${OSGDB_LIBRARY}
				-DOSGDB_INCLUDE_DIR:PATH=${OSGDB_INCLUDE_DIR}
				-DOSGSHADOW_LIBRARY:PATH=${OSGSHADOW_LIBRARY}
				-DOSGSHADOW_INCLUDE_DIR:PATH=${OSGSHADOW_INCLUDE_DIR}
				-DCMAKE_INSTALL_PREFIX:PATH=<INSTALL_DIR>
)


# ------------- Bullet ----------------------------------
#http://bulletphysics.org/mediawiki-1.5.8/index.php/Installation

ExternalProject_Add(
	bullet
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/bullet/"
	CMAKE_ARGS -DBUILD_DEMOS:BOOL=OFF
				-DBUILD_CPU_DEMOS:BOOL=OFF
				-DBUILD_AMD_OPENCL_DEMOS:BOOL=OFF
				-DBUILD_INTEL_OPENCL_DEMOS:BOOL=OFF
				-DBUILD_MINICL_OPENCL_DEMOS:BOOL=OFF
				-DBUILD_NVIDIA_OPENCL_DEMOS:BOOL=OFF
				-DUSE_DX11:BOOL=OFF
				-DUSE_GLUT:BOOL=OFF
				-DUSE_GRAPHICAL_BENCHMARK:BOOL=OFF
				-DBUILD_EXTRAS:BOOL=OFF
				-DBUILD_UNIT_TESTS:BOOL=OFF
				-DUSE_MSVC_RUNTIME_LIBRARY_DLL:BOOL=ON
				#-DBUILD_SHARED_LIBS:BOOL=OFF  # this is broken in Visual Studio
				# Add -fPIC on Linux so we can actually link into a shared lib later
				"-DCMAKE_CXX_FLAGS=${CMAKE_SHARED_LIBRARY_CXX_FLAGS}"
				"-DCMAKE_C_FLAGS=${CMAKE_SHARED_LIBRARY_C_FLAGS}"
				-DINSTALL_LIBS:BOOL=ON
				-DBUILD_MULTITHREADING:BOOL=ON
				-DCMAKE_INSTALL_PREFIX:PATH=<INSTALL_DIR>
#				-DPKGCONFIG_INSTALL_PREFIX:PATH=${CMAKE_INSTALL_PREFIX}
#				-DINCLUDE_INSTALL_DIR:PATH=${CMAKE_INSTALL_PREFIX}/include/
#				-DLIB_DESTINATION:PATH=${CMAKE_INSTALL_PREFIX}/lib/

				# Workaround inadequate find scripts.
				# This will let us find the static libs (.lib) on Windows since Bullet doesn't name them nicely
				-DCMAKE_DEBUG_POSTFIX=
				-DCMAKE_MINSIZEREL_POSTFIX=
				-DCMAKE_RELWITHDEBINFO_POSTFIX=
)


# ------------- osgBullet ----------------------------------
set(prefix_var ${CMAKE_BINARY_DIR}/osgworks/ ${CMAKE_CURRENT_SRC_DIR}/submodules/osgworks/include/)

ExternalProject_Get_Property(osgWorks INSTALL_DIR)
set(OSGWORKS_INSTALL_DIR ${INSTALL_DIR} CACHE INTERNAL "")
message(STATUS "Installing osgWorks to ${OSGWORKS_INSTALL_DIR}")

ExternalProject_Get_Property(bullet INSTALL_DIR)
set(BULLET_INSTALL_DIR ${INSTALL_DIR} CACHE INTERNAL "")
message(STATUS "Installing Bullet to ${BULLET_INSTALL_DIR}")

ExternalProject_Add(
	osgBullet
	DEPENDS osgWorks bullet
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/osgbullet/"
	CMAKE_ARGS
	"-DCMAKE_PREFIX_PATH:PATH=${OSGWORKS_INSTALL_DIR};${BULLET_INSTALL_DIR}"
	-DBULLET_ROOT=${BULLET_INSTALL_DIR}
	-DCMAKE_INSTALL_PREFIX:PATH=<INSTALL_DIR>
	
	-DOSGBULLET_INSTALL_DATA:BOOL=NO
	-DOSGBULLET_BUILD_EXAMPLES:BOOL=NO
	
	-DOSG_LIBRARY:PATH=${OSG_LIBRARY}
	-DOSG_INCLUDE_DIR:PATH=${OSG_INCLUDE_DIR}
	-DOPENSCENEGRAPH_INCLUDE_DIR:PATH=${OPENSCENEGRAPH_INCLUDE_DIR}
	-DOPENSCENEGRAPH_LIBRARIES:PATH=${OPENSCENEGRAPH_LIBRARIES}
	-DOSGGA_LIBRARY:PATH=${OSGGA_LIBRARY}
	-DOSGGA_INCLUDE_DIR:PATH=${OSGGA_INCLUDE_DIR}
	-DOSGTEXT_LIBRARY:PATH=${OSGTEXT_LIBRARY}
	-DOSGTEXT_INCLUDE_DIR:PATH=${OSGTEXT_INCLUDE_DIR}
	-DOSGVIEWER_LIBRARY:PATH=${OSGVIEWER_LIBRARY}
	-DOSGVIEWER_INCLUDE_DIR:PATH=${OSGVIEWER_INCLUDE_DIR}
	-DOSGUTIL_LIBRARY:PATH=${OSGUTIL_LIBRARY}
	-DOSGUTIL_INCLUDE_DIR:PATH=${OSGUTIL_INCLUDE_DIR}
	-DOSGSIM_LIBRARY:PATH=${OSGSIM_LIBRARY}
	-DOSGSIM_INCLUDE_DIR:PATH=${OSGSIM_INCLUDE_DIR}
	-DOSGDB_LIBRARY:PATH=${OSGDB_LIBRARY}
	-DOSGDB_INCLUDE_DIR:PATH=${OSGDB_INCLUDE_DIR}
	-DOSGSHADOW_LIBRARY:PATH=${OSGSHADOW_LIBRARY}
	-DOSGSHADOW_INCLUDE_DIR:PATH=${OSGSHADOW_INCLUDE_DIR}
	-DOPENTHREADS_LIBRARY:PATH=${OPENTHREADS_LIBRARY}
	-DOPENTHREADS_INCLUDE_DIR:PATH=${OPENTHREADS_INCLUDE_DIR}
)


ExternalProject_Get_Property(osgBullet INSTALL_DIR)
set(OSGBULLET_INSTALL_DIR ${INSTALL_DIR} CACHE INTERNAL "")
